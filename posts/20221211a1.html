<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta charset="UTF-8">
  <meta 
    name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta 
    http-equiv="X-UA-Compatible" 
    content="ie=edge">
  <meta 
    name="theme-color" 
    content="#fff" 
    id="theme-color">
  <meta 
    name="description" 
    content="记录工作和学习中的成果，分享一些踩坑记录和代码">
  <link 
    rel="icon" 
    href="/images/themes/%E6%98%9F%E7%90%83.png">
  <title>QT-ListViewLayout</title>
  
    
      <meta 
        property="og:title" 
        content="QT-ListViewLayout">
    
    
      <meta 
        property="og:url" 
        content="http://mirrorcg.github.io/posts/20221211a1.html">
    
    
      <meta 
        property="og:img" 
        content="/images/home/Myhead.jpg">
    
    
      <meta 
        property="og:img" 
        content="&lt;p style=&#34;text-indent:2em&#34;&gt;本文为记录摘抄自 ZooTool 工具集中的 ListViewLayout">
    
    
      <meta 
        property="og:type" 
        content="article">
      <meta 
        property="og:article:published_time" 
        content="2022-12-11">
      <meta 
        property="og:article:modified_time" 
        content="2022-12-11">
      <meta 
        property="og:article:author" 
        content="Mirror">
      
        
          <meta 
            property="og:article:tag" 
            content="学习笔记">
        
          <meta 
            property="og:article:tag" 
            content="QT布局">
        
      
    
  
  <script>
    function loadScript(url, cb) {
      var script = document.createElement('script');
      script.src = url;
      if (cb) script.onload = cb;
      script.async = true;
      document.body.appendChild(script);
    }
    function loadCSS(href, data, attr) {
      var sheet = document.createElement('link');
      sheet.ref = 'stylesheet';
      sheet.href = href;
      sheet.dataset[data] = attr;
      document.head.appendChild(sheet);
    }
    function changeCSS(cssFile, data, attr) {
      var oldlink = document.querySelector(data);
      var newlink = document.createElement("link");
      newlink.setAttribute("rel", "stylesheet");
      newlink.setAttribute("href", cssFile);
      newlink.dataset.prism = attr;
      document.head.replaceChild(newlink, oldlink);
    }
  </script>
  
    
      
      
      
      
        
        
        
        <script>
          function prismThemeChange() {
            if(document.getElementById('theme-color').dataset.mode === 'dark') {
              if(document.querySelector('[data-prism]')) {
                changeCSS('/js/lib/prism/prism-tomorrow.min.css', '[data-prism]', 'prism-tomorrow');
              } else {
                loadCSS('/js/lib/prism/prism-tomorrow.min.css', 'prism', 'prism-tomorrow');
              }
            } else {
              if(document.querySelector('[data-prism]')) {
                changeCSS('/js/lib/prism/prism.min.css', '[data-prism]', 'prism');
              } else {
                loadCSS('/js/lib/prism/prism.min.css', 'prism', 'prism');
              }
            }
          }
          prismThemeChange()
        </script>
      
      
        
        <link rel="stylesheet" href="/js/lib/prism/prism-line-numbers.min.css">
      
    
  
  <script>
    // control reverse button
    var reverseDarkList = {
      dark: 'light',
      light: 'dark'
    };
    var themeColor = {
      dark: '#1c1c1e',
      light: '#fff'
    }
    // get the data of css prefers-color-scheme
    var getCssMediaQuery = function() {
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };
    // reverse current darkmode setting function
    var reverseDarkModeSetting = function() {
      var setting = localStorage.getItem('user-color-scheme');
      if(reverseDarkList[setting]) {
        setting = reverseDarkList[setting];
      } else if(setting === null) {
        setting = reverseDarkList[getCssMediaQuery()];
      } else {
        return;
      }
      localStorage.setItem('user-color-scheme', setting);
      return setting;
    };
    // apply current darkmode setting
  </script>
  
    <script>
      var setDarkmode = function(mode) {
      var setting = mode || localStorage.getItem('user-color-scheme');
      if(setting === getCssMediaQuery()) {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[setting];
        document.getElementById('theme-color').dataset.mode = setting;
        prismThemeChange();
      } else if(reverseDarkList[setting]) {
        document.documentElement.setAttribute('data-user-color-scheme', setting);
        document.getElementById('theme-color').content = themeColor[setting];
        document.getElementById('theme-color').dataset.mode = setting;
        prismThemeChange();
      } else {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[getCssMediaQuery()];
        document.getElementById('theme-color').dataset.mode = getCssMediaQuery();
        prismThemeChange();
      }
    };
    setDarkmode();
    </script>
  
  
  <link rel="preload" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css" as="style" >
  <link rel="preload" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css" as="style" >
  
  
    <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.js" as="script">
    <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.css" as="style" >
  
  
    <link rel="preload" href="/js/lib/lozad.min.js" as="script">
  
  
  
  
  
    
    <link rel="prefetch" href="//unpkg.com/valine/dist/Valine.min.js" as="script">
  
  
  
  <link rel="stylesheet" href="/css/main.css">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css">
  
    <link rel="stylesheet" href="/js/lib/lightbox/baguetteBox.min.css">
  
<meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="Mirror的个人博客" type="application/atom+xml">
</head>

  <body>
    <div class="wrapper">
       
      <nav class="navbar">
  <div class="navbar-logo">
    <span class="navbar-logo-main">
      
        <img 
          class="navbar-logo-img"
          width="32"
          height="32"
          src="/images/themes/%E6%98%9F%E7%90%83.png" 
          alt="blog logo">
      
      <span class="navbar-logo-dsc">Mirror`s Blog</span>
    </span>
  </div>
  <div class="navbar-menu">
    
      <a 
        href="/" 
        class="navbar-menu-item">
        
          首页
        
      </a>
    
      <a 
        href="/archives" 
        class="navbar-menu-item">
        
          归档
        
      </a>
    
      <a 
        href="/tags" 
        class="navbar-menu-item">
        
          标签
        
      </a>
    
      <a 
        href="/categories" 
        class="navbar-menu-item">
        
          分类
        
      </a>
    
      <a 
        href="/links" 
        class="navbar-menu-item">
        
          友链
        
      </a>
    
      <a 
        href="/about" 
        class="navbar-menu-item">
        
          关于我
        
      </a>
    
    <a 
      class="navbar-menu-item darknavbar" 
      id="dark">
      <i class="iconfont icon-weather"></i>
    </a>
    <a 
      class="navbar-menu-item searchnavbar" 
      id="search">
      <i 
        class="iconfont icon-search" 
        style="font-size: 1.2rem; font-weight: 400;">
      </i>
    </a>
  </div>
</nav> 
      
      <div 
        id="local-search" 
        style="display: none">
        <input
          class="navbar-menu-item"
          id="search-input"
          placeholder="请输入搜索内容..." />
        <div id="search-content"></div>
      </div>
      
      <div class="section-wrap">
        <div class="container">
          <div class="columns">
            <main class="main-column">
<article class="card card-content">
  <header>
    <h1 class="post-title">
      QT-ListViewLayout
    </h1>
  </header>
  <div class="post-meta post-show-meta">
    <time datetime="2022-12-11T14:38:25.000Z">
      <i 
        class="iconfont icon-calendar" 
        style="margin-right: 2px;">
      </i>
      <span>2022-12-11</span>
    </time>
    
      <span class="dot"></span>
      
        <a 
          href="/categories/Qt/" 
          class="post-meta-link">
          Qt
        </a>
      
        <a 
          href="/categories/Qt/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" 
          class="post-meta-link">
          学习笔记
        </a>
      
    
    
      <span class="dot"></span>
      <span>9.3k 字</span>
    
  </div>
  
    <div 
      class="post-meta post-show-meta" 
      style="margin-top: -10px;">
      <div style="display: flex; align-items: center;">
        <i 
          class="iconfont icon-biaoqian" 
          style="margin-right: 2px; font-size: 1.15rem;">
        </i>
        
          
          <a 
            href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" 
            class="post-meta-link">
            学习笔记
          </a>
        
          
            <span class="dot"></span>
          
          <a 
            href="/tags/QT%E5%B8%83%E5%B1%80/" 
            class="post-meta-link">
            QT布局
          </a>
        
      </div>
    </div>
  
  </header>
  <div 
    id="section" 
    class="post-content">
    <p style="text-indent:2em">本文为记录摘抄自 ZooTool 工具集中的 ListViewLayout <span id="more"></span>,该布局可以根据父 UI 组件窗口的宽度，调整每一行所能容纳的最大的元素个数。类似flowLayout,但比flowLayout省资源。</p>

<p>示例代码如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"># -*- coding:utf-8 -*-
# !&#x2F;usr&#x2F;bin&#x2F;env python3
# Author: Mirror
# File: flowLayout
# Time: 2022-12-10 21:43
# Update： 2022-12-12 22:43
# Environment:PyCharm
# Blog: www.mirrorcg.com
# Description: listViewLayout布局示例
# &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
import os
import glob
import tempfile
import copy
import json
import zipfile
import imghdr
import sys
from functools import partial
from PySide2.QtGui import *
from PySide2.QtCore import *
from PySide2.QtWidgets import *

if sys.version_info[0] &#x3D;&#x3D; 3:
    string_types &#x3D; str
else:
    string_types &#x3D; bytes


INFOASSET &#x3D; &quot;assetType&quot;  # key for the .zooinfo dict and file (as json)
INFOCREATORS &#x3D; &quot;creators&quot;  # key for the .zooinfo dict and file (as json)
INFOWEBSITES &#x3D; &quot;websites&quot;  # key for the .zooinfo dict and file (as json)
INFOTAGS &#x3D; &quot;tags&quot;  # key for the .zooinfo dict and file (as json)
INFODESCRIPTION &#x3D; &quot;description&quot;  # key for the .zooinfo dict and file (as json)
INFOSAVE &#x3D; &quot;saved&quot;  # key for the .zooinfo dict and file (as json)
INFOANIM &#x3D; &quot;animation&quot;  # key for the .zooinfo dict and file (as json)
VERSIONKEY &#x3D; &quot;version&quot;
GENERICVERSIONNO &#x3D; &quot;1.0.0&quot;  # the version number of the generic file format
ASSETTYPES &#x3D; [&quot;Not Specified&quot;, &quot;Hero Model&quot;, &quot;Prop Model&quot;, &quot;Background&quot;, &quot;Background Lights&quot;, &quot;Scene&quot;, &quot;IBL&quot;, &quot;Lights&quot;,
              &quot;Shaders&quot;, &quot;Animation&quot;, &quot;Camera&quot;]
ZOOINFOSUFFIX &#x3D; &quot;zooInfo&quot;  # TODO use new constant in zoosceneconstants
QTSUPPORTEDIMAGES &#x3D; (&#39;bmp&#39;, &#39;gif&#39;, &#39;jpg&#39;, &#39;jpeg&#39;, &#39;mng&#39;, &#39;png&#39;, &#39;pbm&#39;, &#39;pgm&#39;, &#39;ppm&#39;, &#39;tiff&#39;, &#39;xbm&#39;, &#39;xpm&#39;, &#39;svg&#39;, &#39;tga&#39;)
DEPENDENCY_FOLDER &#x3D; &quot;fileDependencies&quot;  # the prefix of the dependency folder for file dependencies.
ZOO_THUMBNAIL &#x3D; &quot;thumbnail&quot;  # the name of thumbnail images minus the file extension which can be png or jpg etc
ZOOSCENE_EXT &#x3D; &quot;zooScene&quot;  # main suffix for zooScene files
PREFERENCE_FOLDER &#x3D; &quot;preferences&quot;
INTERFACE_FOLDER &#x3D; &quot;interface&quot;
preference &#x3D; None
DIRECTORYNAMEDEPENDENCIES &#x3D; &quot;fileDependencies&quot;


def dpiScale(value):
    &quot;&quot;&quot;根据当前 DPI 按值调整大小
    :param value: 默认2K int型
    :return value: 当前显示器的的大小 int型
    &quot;&quot;&quot;
    DEFAULT_DPI &#x3D; 96
    mult &#x3D; max(1, float(QApplication.desktop().logicalDpiY()) &#x2F; float(DEFAULT_DPI))
    return value * mult


def getTempDir():
    &quot;&quot;&quot;返回所有操作系统上的临时目录路径&quot;&quot;&quot;
    return os.environ.get(&#39;TEMP&#39;, os.environ.get(&#39;TMP&#39;, os.environ.get(&#39;TMPDIR&#39;, &#39;&#x2F;tmp&#39;)))


def getFilesNoExt(directory, fileNoExtension):
    &quot;&quot;&quot;给定一个没有扩展名的文件，找到文件名，对于查找扩展名未知的缩略图很有用，即可能是.jpg或.png
    :param directory: 用于搜索和返回文件名的目录 str
    :param fileNoExtension: 要查找的文件的名称 str
    :return fileList: 与名称匹配的文件列表，可以是空的或多个 list(str)
    &quot;&quot;&quot;
    fileList &#x3D; list()
    os.chdir(directory)
    for fileName in glob.glob(&quot;&#123;&#125;.*&quot;.format(fileNoExtension)):
        fileList.append(fileName)
    # TODO: Probably shouldn&#39;t be using glob, return the current path to the directory
    tempDir &#x3D; getTempDir()
    os.chdir(tempDir)
    return fileList


def getImageNoExtension(directory, nameNoExtension):
    &quot;&quot;&quot;返回目录中具有名称（不带文件扩展名）的图像列表，有助于查找“缩略图.png或缩略图.jpg”，返回找到的文件的列表
    :param directory: 用于搜索和返回文件名的目录 str
    :param nameNoExtension: 没有扩展名的文件名 str
    :return imagePathList: 与名称NoExtension匹配的图像列表 list
    &quot;&quot;&quot;
    imagePathList &#x3D; list()
    fileList &#x3D; getFilesNoExt(directory, nameNoExtension)
    if not fileList:
        return
    for file in fileList:
        filename, file_extension &#x3D; os.path.splitext(file)
        file_extension &#x3D; file_extension.replace(&quot;.&quot;, &quot;&quot;)
        if file_extension in QTSUPPORTEDIMAGES:
            imagePathList.append(file)
    return imagePathList


def thumbnails(directory, fileListNoExt):
    &quot;&quot;&quot;从不带扩展名的 zooScene 列表中返回缩略图路径的列表
    :return thumbPathList: 每个 zooScene 文件一个缩略图路径列表（无扩展名）
    :rtype thumbFullPathList: 基础字符串列表
    &quot;&quot;&quot;
    thumbFullPathList &#x3D; list()
    for i, zooSceneName in enumerate(fileListNoExt):
        dependFolder &#x3D; &quot;_&quot;.join([zooSceneName, DEPENDENCY_FOLDER])
        dependFolderPath &#x3D; os.path.join(directory, dependFolder)
        if not os.path.isdir(dependFolderPath):
            thumbFullPathList.append(None)
            continue
        imageList &#x3D; getImageNoExtension(dependFolderPath, ZOO_THUMBNAIL)
        if imageList:  # image list is only thumbnail, take the first image, could be jpg or png
            thumbFullPathList.append(os.path.join(dependFolderPath, imageList[0]))
            continue
        thumbFullPathList.append(None)
    return thumbFullPathList


def filesByExtension(directory, extensionList):
    &quot;&quot;&quot;列出给定文件扩展名列表的给定目录中的所有文件，扩展名应该没有句号，即 [“zooScene”， “json”， “jpg”]
    Return Example:
        [&quot;soft_sunsetSides.zooScene&quot;, &quot;sun_redHarsh.zooScene&quot;, &quot;sun_warmGlow.zooScene&quot;]
    :param directory: 用于搜索和返回文件名的目录 str
    :param extensionList: A list of extensions to search [&quot;zooScene&quot;, &quot;json&quot;, &quot;jpg&quot;]
    :type extensionList: list of basestring
    :return fileList: A list of files returned that are in the directory and match the extension list
    :rtype fileList: list()str
    &quot;&quot;&quot;
    fileList &#x3D; list()
    if not os.path.isdir(directory):  # check if directory actually exists
        return fileList  # emptyList and directory

    for ext in extensionList:
        for filePath in glob.glob(os.path.join(directory, &quot;*.&#123;&#125;&quot;.format(ext))):
            fileList.append(os.path.basename(filePath))
    # TODO: Probably shouldn&#39;t be using glob, return the current path to the directory
    tempDir &#x3D; getTempDir()
    os.chdir(tempDir)
    return fileList


def saveJson(data, filepath, **kws):
    &quot;&quot;&quot;此过程将给定数据保存到 json 文件
    :param kws: Json Dumps arguments , see standard python docs
    &quot;&quot;&quot;
    try:
        with open(filepath, &#39;w&#39;) as f:
            json.dump(data, f, **kws)
    except IOError:
        print(&quot;Data not saved to file &#123;&#125;&quot;.format(filepath))
        return False

    print(&quot;-------&gt;&gt; file correctly saved to : &#123;0&#125;&quot;.format(filepath))
    return True


def ensureFolderExists(path, permissions&#x3D;0o775, placeHolder&#x3D;False):
    &quot;&quot;&quot;如果该文件夹不存在，则将创建一个。由于版本控制错误而构建的函数与未提交的空文件夹，此文件夹可以生成占位符文件。
    :param path: the folderpath to check or create
    :type path: str
    :param permissions: folder permissions mode
    :type permissions: int
    :param placeHolder: if True create a placeholder text file
    :type placeHolder: bool
    :raise OSError: raise OSError if the creation of the folder fails
    &quot;&quot;&quot;
    if not os.path.exists(path):
        try:
            print(&quot;Creating folder &#123;&#125; [&#123;&#125;]&quot;.format(path, permissions))
            os.makedirs(path, permissions)
            if placeHolder:
                placePath &#x3D; os.path.join(path, &quot;placeholder&quot;)
                if not os.path.exists(placePath):
                    with open(placePath, &quot;wt&quot;) as fh:
                        fh.write(&quot;Automatically Generated placeHolder file.&quot;)
                        fh.write(&quot;The reason why this file exists is due to source control system&#39;s which do not &quot;
                                 &quot;handle empty folders.&quot;)
        except OSError as e:
            # more less work if network race conditions(joy!)
            raise


def loadJson(filePath):
    &quot;&quot;&quot;
    此过程加载并返回 json 文件的数据
    :return type&#123;dict&#125;: the content of the file
    &quot;&quot;&quot;
    # load our file
    try:
        with loadFile(filePath) as f:
            data &#x3D; json.load(f)
    except Exception as er:
        print(&quot;file (&#123;&#125;) not loaded&quot;.format(filePath))
        raise er
    # return the files data
    return data


def getFileDependenciesList(zooSceneFullPath, ignoreThumbnail&#x3D;False):
    &quot;&quot;&quot;检索依赖目录 目录名依赖项中所有文件的列表,文件没有完整路径，因此也会返回目录路径，文件是 [“文件名.abc”， “文件名.zooInfo”] 等
    :param zooSceneFullPath: the full path to the file usually .zooscene but can be any extension
    :type zooSceneFullPath: str
    :param ignoreThumbnail: ignores the files called thumbnail.* useful for renaming
    :type ignoreThumbnail: str
    :return fileDependencyList: list of short name files found in the subdirectory DIRECTORYNAMEDEPENDENCIES
    :rtype fileDependencyList: list
    :return fullDirPath: the full path of the sub directory DIRECTORYNAMEDEPENDENCIES
    :rtype fullDirPath: str
    &quot;&quot;&quot;
    fileDependencyList &#x3D; list()
    zooSceneFileName &#x3D; os.path.basename(zooSceneFullPath)
    directoryPath &#x3D; os.path.dirname(zooSceneFullPath)
    fileNameNoExt &#x3D; os.path.splitext(zooSceneFileName)[0]
    newDirectoryName &#x3D; &quot;_&quot;.join([fileNameNoExt, DIRECTORYNAMEDEPENDENCIES])
    fullDirPath &#x3D; os.path.join(directoryPath, newDirectoryName)
    if not os.path.exists(fullDirPath):  # doesn&#39;t already exist
        return fileDependencyList, &quot;&quot;  # return empty as directory doesn&#39;t exist
    os.chdir(fullDirPath)
    for fileName in glob.glob(&quot;&#123;&#125;.*&quot;.format(fileNameNoExt)):
        fileDependencyList.append(fileName)
    if not ignoreThumbnail:
        for fileName in glob.glob(&quot;thumbnail.*&quot;.format(fileNameNoExt)):
            fileDependencyList.append(fileName)
    #  return os.chdir to the temp dir as it gets in the way with file permissions for later renames!
    os.chdir(tempfile.gettempdir())
    return fileDependencyList, fullDirPath


def getSingleFileFromZooScene(zooSceneFullPath, fileExtension):
    &quot;&quot;&quot;返回文件的名称（如果存在），扩展名为 zooSceneFullPath 中的 .abc
    获取与 .zooScene 文件关联的子目录中的所有文件，并筛选文件类型,支持返回一个文件，第一个文件它发现不适合纹理
    :param zooSceneFullPath:  the full path of the .zooScene file to be saved
    :type zooSceneFullPath: str
    :param fileExtension:  the file extension to find no &quot;.&quot;, so alembic is &quot;abc&quot;
    :type fileExtension: str
    :return extFileName: the filename (no directory) of the extension given &gt; for example &quot;myFileName.abc&quot;
    :rtype extFileName: str
    &quot;&quot;&quot;
    extFileName &#x3D; &quot;&quot;
    fileList, directory &#x3D; getFileDependenciesList(zooSceneFullPath)
    if not directory:
        return extFileName
    for fileName in fileList:  # cycle through the files and find if a match with the extension
        if fileName.endswith(fileExtension):
            return os.path.join(directory, fileName)
    return extFileName


def loadFile(filepath):
    if filepath.endswith(&quot;.zip&quot;):
        with zipfile.ZipFile(filepath, &#39;r&#39;) as f:
            yield f
        return
    elif &quot;.zip&quot; in filepath:
        # load from zipfile
        zippath, relativefilePath &#x3D; filepath.split(&quot;.zip&quot;)
        zipPath &#x3D; zippath + &quot;.zip&quot;

        with zipfile.ZipFile(zipPath, &#39;r&#39;) as zip:
            path &#x3D; relativefilePath.replace(&quot;\\&quot;, &quot;&#x2F;&quot;).lstrip(&quot;&#x2F;&quot;)
            for i in iter(zip.namelist()):
                if path &#x3D;&#x3D; i:
                    yield zip.open(i)
                    break

        return
    with open(filepath) as f:
        yield f


def createTagInfoDict(assetType, creator, website, tags, description, saveInfo, animInfo):
    &quot;&quot;&quot;为zooInfo 文件创建一个字典
    :param assetType: the information about asset type, model, scene, lights, shaders, etc
    :type assetType: str
    :param creator: the information about creator&#x2F;s
    :type creator: str
    :param website: the information about the creators website links
    :type website: str
    :param tags: the tag information
    :type tags: str
    :param description: the full description
    :type description: str
    :param saveInfo: the file information saved as a list [&quot;alembic&quot;, &quot;generic lights&quot;] etc
    :type saveInfo: list
    :param animInfo: the animation information of the file &quot;0 100&quot; or &quot;&quot; or None if none
    :type animInfo: str
    :return zooInfoDict: the dict containing all information including the file version number
    :rtype zooInfoDict: str
    &quot;&quot;&quot;
    zooInfoDict &#x3D; &#123;INFOASSET: assetType,
                   INFOCREATORS: creator,
                   INFOWEBSITES: website,
                   INFOTAGS: tags,
                   INFODESCRIPTION: description,
                   INFOSAVE: saveInfo,
                   INFOANIM: animInfo,
                   VERSIONKEY: GENERICVERSIONNO&#125;
    return zooInfoDict


def getZooInfoFromFile(zooSceneFullPath, message&#x3D;True):
    &quot;&quot;&quot;从 .zooScene 获取其他文件，例如从磁盘上的文件中获取 .zooInfo
    :param zooSceneFullPath: the full path of the zooScene file, this will save out as another file zooInfo
    :type zooSceneFullPath: str
    :return zooInfoDict: the dictionary with all info information, if None the file wasn&#39;t found
    :rtype zooInfoDict: dict
    :return fileFound: was the zooInfo file found?
    :rtype fileFound: bool
    &quot;&quot;&quot;
    zooInfoFileFullPath &#x3D; getSingleFileFromZooScene(zooSceneFullPath, ZOOINFOSUFFIX)
    if not os.path.exists(zooInfoFileFullPath):  # doesn&#39;t exist
        if message:
            om2.MGlobal.displayWarning(&quot;ZooInfo File Not Found&quot;)
        fileFound &#x3D; False
        return createTagInfoDict(ASSETTYPES[0], &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;), fileFound  # return the empty dict as no file found
    fileFound &#x3D; True
    return loadJson(zooInfoFileFullPath), fileFound  # returns zooInfoDict


def createEmptyInfoDict():
    &quot;&quot;&quot;创建一个空的 .zooInfo 字典&quot;&quot;&quot;
    infoDict &#x3D; &#123;u&quot;assetType&quot;: u&quot;&quot;,
                u&quot;animation&quot;: None,
                u&quot;description&quot;: u&quot;&quot;,
                u&quot;version&quot;: u&quot;1.0.0&quot;,
                u&quot;tags&quot;: u&quot;&quot;,
                u&quot;creators&quot;: u&quot;&quot;,
                u&quot;saved&quot;: str(list()),
                u&quot;websites&quot;: u&quot;&quot;
                &#125;
    return infoDict


def infoDictionaries(zooSceneNameList, directory):
    &quot;&quot;&quot; 返回每个 .zooScene 文件的信息字典列表。这些词典包含作者、标签、描述等信息
    :return infoDictList: 每个 .zooScene 文件的信息字典列表
    :rtype infoDictList: list of dict
    &quot;&quot;&quot;
    infoDictList &#x3D; list()
    if not zooSceneNameList:
        return dict()
    for zooSceneFile in zooSceneNameList:
        lightPresetFullPath &#x3D; os.path.join(directory, zooSceneFile)
        zooInfoDict, fileFound &#x3D; getZooInfoFromFile(lightPresetFullPath, message&#x3D;False)
        if fileFound:
            infoDictList.append(zooInfoDict)
        else:
            infoDictList.append(createEmptyInfoDict())
    return infoDictList


def isImage(path):
    try:
        return imghdr.what(path) is not None or path.split(os.extsep)[-1] in QTSUPPORTEDIMAGES
    except IOError:
        return False


class ThumbnailDelegate(QStyledItemDelegate):
    def __init__(self, parent):
        super(ThumbnailDelegate, self).__init__(parent)

    def sizeHint(self, option, index):
        return index.model().itemFromIndex(index).sizeHint()

    def paint(self, painter, options, index):
        index.model().itemFromIndex(index).paint(painter, options, index)


class ThumbListView(QListView):
    contextMenuRequested &#x3D; Signal(list, object)
    requestZoom &#x3D; Signal(object, float)
    # QModelIndex, Treeitem
    requestDoubleClick &#x3D; Signal(object, object)
    zoomAmount &#x3D; 1
    defaultMinIconSize &#x3D; 20
    defaultMaxIconSize &#x3D; 512
    defaultIconSize &#x3D; QSize(256, 256)
    stateChanged &#x3D; Signal()

    WheelEvent &#x3D; 1
    EnterEvent &#x3D; 2
    CalcInitialEvent &#x3D; 3
    CalcEvent &#x3D; 4
    VerticalSliderReleasedEvent &#x3D; 5

    def __init__(self, parent&#x3D;None, delegate&#x3D;None, iconSize&#x3D;defaultIconSize, uniformItems&#x3D;False):

        super(ThumbListView, self).__init__(parent&#x3D;parent)
        self.setContextMenuPolicy(Qt.CustomContextMenu)
        self.customContextMenuRequested.connect(self._contextMenu)
        self.autoScale &#x3D; True
        self.defaultSize &#x3D; None
        self.initialIconSize &#x3D; None
        self.columnQueue &#x3D; 0
        self.columnOffset &#x3D; 1

        self.zoomable &#x3D; True
        self._iconSize &#x3D; QSize()
        self.setIconSize(iconSize or self.defaultIconSize)
        self.initUi()

        self.maxColumns &#x3D; 8
        self.setVerticalScrollBar(QScrollBar(self))
        self.connections()

        self._delegate &#x3D; delegate(self) if delegate is not None else ThumbnailDelegate(self)
        self.setItemDelegate(self._delegate)
        self.setUpdatesEnabled(True)
        self._uniformItemSizes &#x3D; uniformItems
        self.setUniformItemSizes(uniformItems)

    def initUi(self):
        self.setMouseTracking(True)
        self.setSelectionRectVisible(True)
        self.setViewMode(QListView.IconMode)
        self.setResizeMode(QListView.Adjust)
        self.setSelectionMode(QListView.SingleSelection)
        self.setHorizontalScrollBarPolicy(Qt.ScrollBarAlwaysOff)

        self.setDragEnabled(False)
        self.setAcceptDrops(False)

    def _contextMenu(self, position):
        model &#x3D; self.model()
        if model is None:
            return
        menu &#x3D; QMenu(self)
        selectionModel &#x3D; self.selectionModel()
        selection &#x3D; [model.itemFromIndex(index) for index in selectionModel.selectedIndexes()]
        self.contextMenuRequested.emit(selection, menu)
        menu.exec_(self.viewport().mapToGlobal(position))

    def setUniformItemSizes(self, enable):
        self._uniformItemSizes &#x3D; enable
        if self.model():
            self.model().setUniformItemSizes(enable)

    def setIconSize(self, size):
        self._iconSize &#x3D; size
        super(ThumbListView, self).setIconSize(size)

    def connections(self):
        self.verticalScrollBar().sliderMoved.connect(self.verticalSliderMoved)
        self.verticalScrollBar().sliderReleased.connect(self.verticalSliderReleased)
        self.clicked.connect(lambda: self.stateChanged.emit())
        self.activated.connect(lambda: self.stateChanged.emit())
        # self.entered.connect(lambda: self.stateChanged.emit())

    def wheelEvent(self, event):
        &quot;&quot;&quot; 重写以处理缩放 listview.
        :type event: :class:&#96;QEvent&#96;
        &quot;&quot;&quot;
        modifiers &#x3D; event.modifiers()
        if self.zoomable and modifiers &#x3D;&#x3D; Qt.ControlModifier:
            if event.delta() &gt; 0:
                self.columnOffset -&#x3D; 1
            else:
                self.columnOffset +&#x3D; 1
                self.columnOffset &#x3D; min(self.columnOffset, self.maxColumns)

            size &#x3D; self.widgetSize()
            index &#x3D; self.indexAt(event.pos())

            # if its an invalid index, find closest instead
            if not index.isValid():
                index &#x3D; self.closestIndex(event.pos())

            self.calcResize(size)
            QTimer.singleShot(0, lambda: self.scrollTo(index))
            event.accept()
            self.stateChanged.emit()
            return
        super(ThumbListView, self).wheelEvent(event)
        self.loadVisibleIcons()
        self.stateChanged.emit()

    def state(self):
        &quot;&quot;&quot; Returns useful settings to copy from one list view behaviour to another

        :return:
        :rtype:
        &quot;&quot;&quot;
        selectedIndex &#x3D; self.selectionModel().currentIndex().row()
        ret &#x3D; &#123;&quot;sliderPos&quot;: self.verticalScrollBar().value(),
               &quot;sliderMin&quot;: self.verticalScrollBar().minimum(),
               &quot;sliderMax&quot;: self.verticalScrollBar().maximum(),
               &quot;selected&quot;: selectedIndex,
               &quot;columns&quot;: self.columnOffset,
               &quot;zoomAmount&quot;: self.zoomAmount,
               &quot;iconSize&quot;: self._iconSize,
               &quot;initialIconSize&quot;: self.initialIconSize,
               &quot;defaultSize&quot;: self.defaultSize,
               &quot;fixedSize&quot;: self.parentWidget().minimumSize()
               &#125;

        return ret

    def setState(self, state):
        &quot;&quot;&quot; Set the state of the listview with the new settings provided from ThumbListView.state()

        :param state:
        :type state:
        :return:
        :rtype:
        &quot;&quot;&quot;
        self.columnOffset &#x3D; state[&#39;columns&#39;]
        self._iconSize &#x3D; state[&#39;iconSize&#39;]
        self.zoomAmount &#x3D; state[&#39;zoomAmount&#39;]
        self.defaultSize &#x3D; state[&#39;defaultSize&#39;]
        self.initialIconSize &#x3D; state[&#39;initialIconSize&#39;]

        fixedSize &#x3D; state[&#39;fixedSize&#39;]

        if fixedSize.width() !&#x3D; 0:
            self.parentWidget().setFixedWidth(fixedSize.width())
        if fixedSize.height() !&#x3D; 0:
            self.parentWidget().setFixedHeight(fixedSize.height())

        self.calcResize(self.widgetSize())
        self.verticalScrollBar().setMinimum(state[&#39;sliderMin&#39;])
        self.verticalScrollBar().setMaximum(state[&#39;sliderMax&#39;])
        self.verticalScrollBar().setValue(state[&#39;sliderPos&#39;])

        self.loadVisibleIcons()

        if state[&#39;selected&#39;] !&#x3D; -1:
            QTimer.singleShot(0, lambda: self.delaySelect(state[&#39;selected&#39;]))

    def delaySelect(self, sel):
        &quot;&quot;&quot; Select index
        :param sel:
        :type sel:
        :return:
        :rtype:
        &quot;&quot;&quot;
        autoScroll &#x3D; self.hasAutoScroll()
        self.setAutoScroll(False)
        self.selectionModel().setCurrentIndex(self.model().index(sel, 0),
                                              QItemSelectionModel.ClearAndSelect)
        self.setAutoScroll(autoScroll)

    def closestIndex(self, pos):
        &quot;&quot;&quot; Get closest index based on pos
        :param pos:
        :type pos:
        :return:
        :rtype:
        &quot;&quot;&quot;
        maxDist &#x3D; -1
        closest &#x3D; None
        for index in self.visibleItems():
            c &#x3D; self.visualRect(index)
            if c.top() &lt;&#x3D; pos.y() &lt;&#x3D; c.bottom():  # Only choose the ones from the same row
                dist &#x3D; pos.x() - c.center().x()
                if maxDist &#x3D;&#x3D; -1 or dist &lt; maxDist:
                    closest &#x3D; index
                    maxDist &#x3D; dist
        return closest

    def loadVisibleIcons(self):
        &quot;&quot;&quot; Loads visible icons in the view if they have not been loaded yet
        :return:
        :rtype:
        &quot;&quot;&quot;

        for index in self.visibleItems(pre&#x3D;5, post&#x3D;5):
            try:
                treeItem &#x3D; self.model().items[index.row()]
                item &#x3D; treeItem.item()
                if not item.iconLoaded():
                    self.model().threadPool.start(item.iconThread)

            except IndexError:
                pass  # this should possibly be handled

    def filter(self, text, tag&#x3D;None):
        filterList &#x3D; self.model().filterList(text, tag)
        self.loadVisibleIcons()

    def verticalSliderReleased(self):
        self.stateChanged.emit()

    def verticalSliderMoved(self, pos):
        &quot;&quot;&quot; On vertical slider moved, reload the visible icons

        :return:
        :rtype:
        &quot;&quot;&quot;
        self.loadVisibleIcons()

    def model(self):
        &quot;&quot;&quot; 获取 ListView model
        :return:
        :rtype: FileViewModel
        &quot;&quot;&quot;
        return super(ThumbListView, self).model()

    def visibleItems(self, pre&#x3D;0, post&#x3D;0):
        &quot;&quot;&quot; 获取可见项。如果要在开头和结尾添加额外的索引，请将 extra 设置为 1 或更多。它只会返回有效索引。
        :param pre: Add extra items behind the currently visible items
        :type pre: int
        :param post: Add extra items after the currently visible items
        :type post: int
        :return: List of indices that are visible plus the pre and post. It only returns valid indices
        :rtype: list of QModelIndex
        &quot;&quot;&quot;
        firstIndex &#x3D; self.indexAt(QPoint(0, 0))
        viewportRect &#x3D; self.viewport().rect()
        items &#x3D; list()
        after &#x3D; post

        i &#x3D; -pre  # We want to check indices behind the firstIndex
        while True:
            sibling &#x3D; firstIndex.sibling(firstIndex.row() + i, 0)
            # The index is visually shown in the viewport?
            if sibling.isValid() and viewportRect.intersects(self.visualRect(sibling)):
                items.append(sibling)
            elif sibling.isValid() and i &lt; 0:  # If it&#39;s indices behind the firstIndex
                items.append(sibling)
            elif sibling.isValid() and after &gt; 0:  # We want some extra indices at the end so keep going
                after -&#x3D; 1
                items.append(sibling)
            elif i &lt; 0 or self.isIndexHidden(sibling):  # We want to keep going even if the behind siblings are invalid,
                # Or hidden by search
                i +&#x3D; 1
                continue

            else:
                break  # Either it is invalid (reached the end) or we&#39;ve gone outside the screen
            i +&#x3D; 1

        return items

    def scrollTo(self, index, hint&#x3D;None):
        &quot;&quot;&quot; 覆盖默认的scrollTo并使用我们自己的
        :param index:
        :type index:
        :return:
        :rtype:
        &quot;&quot;&quot;
        if hint is None:
            itemRect &#x3D; self.rectForIndex(index)
            vbar &#x3D; self.verticalScrollBar()
            mPos &#x3D; self.mapFromGlobal(QCursor().pos())  # Pos of mouse in listview widget
            newPos &#x3D; (float(itemRect.y()) &#x2F; float(self.contentsSize().height())) * \
                     (float(self.contentsSize().height())) - \
                     mPos.y() + \
                     (itemRect.height() * 0.5)  # maybe better if this is the mousePosition relative to the item instead
            vbar.setValue(newPos)
        else:
            super(ThumbListView, self).scrollTo(index, hint)

        self.loadVisibleIcons()

    def widgetSize(self):
        &quot;&quot;&quot; 不带垂直滚动条的大小
        :return:
        :rtype:
        &quot;&quot;&quot;
        size &#x3D; QSize(self.size())
        size -&#x3D; QSize(self.verticalScrollBar().size().width(), 0)
        return size

    def _calculateZoom(self, delta):
        &quot;&quot;&quot; 在通过 &#39;setZoomAmount&#39; 将其应用于图标之前计算缩放系数
        :param delta: the delta value
        :type delta: float
        :return: the converted delta to zoom factor
        :rtype: float
        &quot;&quot;&quot;
        inFactor &#x3D; 1.15
        outFactor &#x3D; 1 &#x2F; inFactor

        if delta &gt; 0:
            zoomFactor &#x3D; inFactor
        else:
            zoomFactor &#x3D; outFactor
        self.zoomAmount &#x3D; zoomFactor
        return zoomFactor

    def setZoomAmount(self, value):
        &quot;&quot;&quot; 通过采用视图图标大小（）*值来设置此视图的缩放量
        :param value:
        :type value:
        :return:
        :rtype:
        &quot;&quot;&quot;
        currentSize &#x3D; QSize(self.initialIconSize)
        newSize &#x3D; currentSize.width() * value
        if newSize &lt; self.defaultMinIconSize:
            return
        currentSize.setWidth(newSize)
        currentSize.setHeight(newSize)
        self.requestZoom.emit(newSize, self.zoomAmount)
        self.setIconSize(currentSize)

    def mouseDoubleClickEvent(self, event):
        if event.button() &#x3D;&#x3D; Qt.LeftButton:
            index &#x3D; self.currentIndex()
            model &#x3D; self.model()
            if model is not None:
                item &#x3D; model.itemFromIndex(index)
                model.doubleClickEvent(index, item)
                self.requestDoubleClick.emit(index, item)

    def resizeEvent(self, event):
        self.calcResize(event.size())
        super(ThumbListView, self).resizeEvent(event)
        self.loadVisibleIcons()

    def setColumns(self, col):
        &quot;&quot;&quot; 根据小组件的当前大小设置列数
        :param col:
        :type col:
        :return:
        :rtype:
        &quot;&quot;&quot;

        self.setIconSize(self.defaultIconSize)

        # Sets columns on next calcResize
        self.columnQueue &#x3D; col

        # Change the default size, but only if it has been already set
        if self.defaultSize is not None:
            self.defaultSize &#x3D; self.widgetSize()
            self.calcResize(self.defaultSize)

    def calcResize(self, size):
        &quot;&quot;&quot; 计算项目的大小调整
        :param size:
        :type size:
        :return:
        :rtype:
        &quot;&quot;&quot;
        if self.defaultSize is None:
            # Initialize values
            self.defaultSize &#x3D; size
            self.initialIconSize &#x3D; QSize(self._iconSize)
            self.stateChanged.emit()
            QTimer.singleShot(0, self.refresh)
            return

        # Exclude the verticalScrollbar space
        if not self.verticalScrollBar().isVisible():
            size -&#x3D; QSize(self.verticalScrollBar().size().width(), 0)

        size -&#x3D; QSize(dpiScale(2), 0)

        # Calculate the number of columns
        iconWidth &#x3D; (self.initialIconSize * self.zoomAmount).width() + self.spacing()
        calcColumns &#x3D; int(size.width() &#x2F; iconWidth)  # calculate number of columns and round it down
        columns &#x3D; calcColumns + self.columnOffset

        # setColumn() was run so set the columns by changing the columnOffset
        if self.columnQueue !&#x3D; 0:
            diff &#x3D; self.columnQueue - calcColumns
            columns &#x3D; self.columnQueue
            self.columnOffset &#x3D; diff
            self.columnQueue &#x3D; 0

        columns &#x3D; max(columns, 1)  # atleast 1 column

        # Set columnOffset maximum and minimum

        # Calculate the new ratio to resize the icons to
        ratio &#x3D; float(iconWidth * columns) &#x2F; float(size.width())
        self.setZoomAmount(1 &#x2F; ratio)
        self.stateChanged.emit()

    def refresh(self):
        &quot;&quot;&quot; 刷新，以便图标正确显示
        :return:
        :rtype:
        &quot;&quot;&quot;
        QCoreApplication.processEvents()
        size &#x3D; self.size() - QSize(self.verticalScrollBar().size().width(), 0)
        self.resizeEvent(QResizeEvent(size, size))
        self.model().layoutChanged.emit()
        if not self.updatesEnabled():
            self.setUpdatesEnabled(True)

    def setModel(self, model):
        model.setUniformItemSizes(self._uniformItemSizes)
        return super(ThumbListView, self).setModel(model)


class ThumbnailViewWidget(QWidget):
    &quot;&quot;&quot;用于查看缩略图的主要小部件，它运行在自定义QStandardItemModel上&quot;&quot;&quot;
    requestSelectionChanged &#x3D; Signal(object, object)
    def __init__(self, parent&#x3D;None, listDelegate&#x3D;None, listView&#x3D;ThumbListView, columns&#x3D;None, iconSize&#x3D;None,
                 fixedWidth&#x3D;None, fixedHeight&#x3D;None, uniformIcons&#x3D;False):
        &quot;&quot;&quot;
        :param parent: the parent widget
        :type parent: QWidget
        :param listDelegate:
        :type listDelegate:
        :param listView:
        :type listView:
        :param columns: The number of square image columns, will vary for non-square images, overrides iconSize
        :type columns: int
        :param iconSize: Set the icon size in pixels, will be overridden by columns
        :type iconSize: QSize
        :param fixedWidth: The fixed width of the widget in pixels, dpi handled
        :type fixedWidth: int
        :param fixedHeight: the fixed height of the widget in pixels, dpi handled
        :type fixedHeight: int
        :param uniformIcons: Will keep the icons square, images will be clipped if True, non square if False
        :type uniformIcons: bool
        &quot;&quot;&quot;
        super(ThumbnailViewWidget, self).__init__(parent&#x3D;parent)
        self.qModel &#x3D; None
        self.listDelegate &#x3D; listDelegate
        self.listViewClass &#x3D; listView  # type: type(ThumbListView)
        self.uniformIcons &#x3D; uniformIcons

        self.initUi()
        self.autoResizeItems &#x3D; True
        self.pagination &#x3D; True

        if iconSize is not None:
            self.setIconSize(iconSize)
        if columns:
            self.setColumns(columns)
        if fixedHeight:
            self.setFixedHeight(dpiScale(fixedHeight))
        if fixedWidth:
            self.setFixedWidth(dpiScale(fixedWidth))

    def initUi(self):
        layout &#x3D; QVBoxLayout(self)
        self.setLayout(layout)
        self.listView &#x3D; self.listViewClass(parent&#x3D;self, delegate&#x3D;self.listDelegate, uniformItems&#x3D;self.uniformIcons)
        layout.addWidget(self.listView)
        self.listView.verticalScrollBar().valueChanged.connect(self.paginationLoadNextItems)
        self.listView.contextMenuRequested.connect(self.contextMenu)

        layout.setContentsMargins(0, 0, 0, 0)
        self.listView.setSpacing(dpiScale(0))

    def setModel(self, model):
        self.listView.setModel(model)
        model.refreshRequested.connect(self.listView.loadVisibleIcons)
        model.view &#x3D; self

        self.qModel &#x3D; model
        if self.listView.selectionModel():
            self.listView.selectionModel().selectionChanged.connect(self.onSelectionChanged)

    def refreshListView(self):
        &quot;&quot;&quot; 刷新列表视图，确保图标正确调整大小&quot;&quot;&quot;
        self.listView.refresh()

    def invisibleRootItem(self):
        if self.qModel:
            return self.qModel.invisibleRootItem()

    def iconSize(self):
        return self.listView.iconSize()

    def setIconSize(self, size):
        if size &#x3D;&#x3D; self.listView.iconSize():
            return
        maxSize &#x3D; self.listView.defaultMaxIconSize
        minSize &#x3D; self.listView.defaultMinIconSize
        width &#x3D; size.width()
        height &#x3D; size.height()
        if width &gt; maxSize or height &gt; maxSize:
            size &#x3D; QSize(maxSize, maxSize)
        elif width &lt; minSize or height &lt; minSize:
            size &#x3D; QSize(minSize, minSize)
        self.listView.setIconSize(size)

    def filter(self, text, tag&#x3D;None):
        self.listView.filter(text, tag)

    def setColumns(self, col):
        &quot;&quot;&quot; 将列重置为默认值&quot;&quot;&quot;
        self.listView.setColumns(col)

    def setIconMinMax(self, size):
        &quot;&quot;&quot; 设置最小和最大图标大小
        :param size: 图标大小的最小值和最大值
        :type size: tuple(int, int)
        &quot;&quot;&quot;
        minSize &#x3D; size[0]
        maxSize &#x3D; size[1]
        self.listView.defaultMinIconSize &#x3D; minSize
        self.listView.defaultMaxIconSize &#x3D; maxSize
        currentSize &#x3D; self.listView.iconSize()
        width &#x3D; currentSize.width()
        height &#x3D; currentSize.height()
        if width &gt; maxSize or height &gt; maxSize:
            size &#x3D; QSize(maxSize, maxSize)
            self.listView.setIconSize(size)
        elif width &lt; minSize or height &gt; minSize:
            size &#x3D; QSize(minSize, minSize)
            self.listView.setIconSize(size)

    def paginationLoadNextItems(self):
        &quot;&quot;&quot;当垂直滑块达到最大值时调用模型 loadData 方法的简单方法，对加载模型的下一页数据很有用。&quot;&quot;&quot;
        if not self.pagination:
            return
        model &#x3D; self.listView.model()
        if model is None:
            return

        vbar &#x3D; self.listView.verticalScrollBar()
        sliderMax &#x3D; vbar.maximum()
        sliderPos &#x3D; vbar.sliderPosition()

        if sliderPos &#x3D;&#x3D; sliderMax:
            indexes &#x3D; self.listView.selectionModel().selection().indexes()
            model.loadData()
            # Reselect selection
            self.listView.setAutoScroll(False)
            [self.listView.selectionModel().setCurrentIndex(index, QItemSelectionModel.SelectCurrent) for index
             in indexes]
            self.listView.setAutoScroll(True)

    def contextMenu(self, items, menu):
        pass

    def onSelectionChanged(self):
        index &#x3D; self.listView.currentIndex()
        model &#x3D; self.listView.model()
        if model is not None:
            item &#x3D; model.itemFromIndex(index)
            model.onSelectionChanged(index, item)
            self.requestSelectionChanged.emit(index, item)


class SettingObject(dict):
    &quot;&quot;&quot;设置类，用于封装给定设置的 json 数据&quot;&quot;&quot;
    def __init__(self, root, relativePath&#x3D;None, **kwargs):

        relativePath &#x3D; relativePath
        if not relativePath.suffix:
            relativePath &#x3D; relativePath.with_suffix(&quot;.json&quot;)
        kwargs[&quot;relativePath&quot;] &#x3D; relativePath
        kwargs[&quot;root&quot;] &#x3D; root
        super(SettingObject, self).__init__(**kwargs)

    def rootPath(self):
        if self.root:
            return self.root
        return

    def path(self):
        return self.root &#x2F; self[&quot;relativePath&quot;]

    def isValid(self):
        if self.root is None:
            return False
        elif (self.root &#x2F; self.relativePath).exists():
            return True
        return False

    def __repr__(self):
        return &quot;&lt;&#123;&#125;&gt; root: &#123;&#125;, path: &#123;&#125;&quot;.format(self.__class__.__name__, self.root, self.relativePath)

    def __cmp__(self, other):
        return self.name &#x3D;&#x3D; other and self.version &#x3D;&#x3D; other.version

    def __getattr__(self, item):
        try:
            return self[item]
        except KeyError:
            return super(SettingObject, self).__getattribute__(item)

    def __setattr__(self, key, value):
        self[key] &#x3D; value

    def save(self, indent&#x3D;False, sort&#x3D;False):
        &quot;&quot;&quot;将文件作为 json 保存到磁盘
        :param indent: 如果为 True，则很好地格式化 json（缩进 &#x3D; 2）
        :type indent: bool
        :return fullPath: 保存的 .json 文件的完整路径
        :rtype fullPath: str
        &quot;&quot;&quot;
        root &#x3D; self.root

        if not root:
            return

        fullPath &#x3D; root &#x2F; self.relativePath
        ensureFolderExists(str(fullPath.parent))
        output &#x3D; copy.deepcopy(self)
        del output[&quot;root&quot;]
        del output[&quot;relativePath&quot;]
        exts &#x3D; fullPath.suffix
        if not exts:
            fullPath &#x3D; fullPath.with_suffix(&quot;json&quot;)
        if not indent:
            saveJson(output, str(fullPath), sort_keys&#x3D;sort)
        else:
            saveJson(output, str(fullPath), indent&#x3D;2, sort_keys&#x3D;sort)

        return self.path()


class ItemSignals(QObject):
    &quot;&quot;&quot;
    定义正在运行的工作线程中可用的信号。
    支持的信号包括：
    完成：无数据
    错误：&#96;tuple&#96; (exctype, value, traceback.format_exc() )
    处理结果：&#96;object&#96; 从处理中返回的数据，任何东西
    处理进度：&#96;int&#96; 指示进度百分比
    &quot;&quot;&quot;
    updated &#x3D; Signal(object)
    finished &#x3D; Signal()
    error &#x3D; Signal(tuple)
    result &#x3D; Signal(object)
    progress &#x3D; Signal(int)


class TreeItem(QStandardItem):
    backgroundColor &#x3D; QColor(70, 70, 80)
    backgroundColorSelected &#x3D; QColor(50, 180, 240)
    backgroundColorHover &#x3D; QColor(50, 180, 150)
    textColorSelected &#x3D; QColor(255, 255, 255)
    textColor &#x3D; QColor(255, 255, 255)
    textBGColor &#x3D; QColor(0, 0, 0)
    backgroundBrush &#x3D; QBrush(backgroundColor)
    backgroundColorSelectedBrush &#x3D; QBrush(backgroundColorSelected)
    backgroundColorHoverBrush &#x3D; QBrush(backgroundColorHover)
    borderColorSelected &#x3D; QColor(0, 0, 0)
    borderColorHover &#x3D; QColor(0, 0, 0)
    borderColor &#x3D; QColor(0, 0, 0)
    backgroundColorIcon &#x3D; QColor(50, 50, 50)

    def __init__(self, item, parent&#x3D;None, themePref&#x3D;None, squareIcon&#x3D;False):
        super(TreeItem, self).__init__(parent&#x3D;parent)
        self.currentTheme &#x3D; &quot;&quot;
        self.padding &#x3D; 0
        self.textHeight &#x3D; 11
        self.borderWidth &#x3D; 1
        self.textPaddingH &#x3D; 7
        self.textPaddingV &#x3D; 2

        self.showText &#x3D; True
        self._item &#x3D; item
        self._pixmap &#x3D; None
        self.iconSize &#x3D; QSize(256, 256)
        self.loaderThread &#x3D; ThreadedIcon(item.iconPath)
        self.setEditable(False)
        self.aspectRatio &#x3D; Qt.KeepAspectRatioByExpanding

        self.themePref &#x3D; themePref
        self.squareIcon &#x3D; squareIcon

        self.setBorderWidth(1)

        if themePref is not None:
            self.updateTheme()

    def updateTheme(self):
        self.currentTheme &#x3D; self.themePref.currentTheme()
        self.textHeight &#x3D; self.themePref.DEFAULT_FONTSIZE
        self.borderWidth &#x3D; self.themePref.ONE_PIXEL
        self.textPaddingH &#x3D; dpiScale(7)
        self.textPaddingV &#x3D; dpiScale(3)
        self.backgroundColorSelected &#x3D; QColor(*self.themePref.BROWSER_SELECTED_COLOR)
        self.backgroundColor &#x3D; QColor(*self.themePref.BROWSER_BG_COLOR)
        self.backgroundBrush &#x3D; QBrush(self.backgroundColor)
        self.backgroundColorHover &#x3D; self.backgroundColor
        self.backgroundColorHoverBrush &#x3D; QBrush(self.backgroundColorHover)
        self.backgroundColorSelectedBrush &#x3D; QBrush(self.backgroundColorSelected)
        self.backgroundColorIcon &#x3D; QColor(*self.themePref.BROWSER_ICON_BG_COLOR)
        self.borderColor &#x3D; QColor(self.backgroundColor)

        self.textColorSelected &#x3D; QColor(*self.themePref.TBL_TREE_ACT_TEXT_COLOR)
        self.borderColorSelected &#x3D; QColor(*self.themePref.BROWSER_SELECTED_COLOR)
        self.borderColorHover &#x3D; QColor(*self.themePref.BROWSER_BORDER_HOVER_COLOR)
        self.textColor &#x3D; QColor(*self.themePref.BROWSER_TEXT_COLOR)

        self.textBGColor &#x3D; QColor(*self.themePref.BROWSER_TEXT_BG_COLOR)

    def item(self):
        return self._item

    def applyFromImage(self, image):
        pixmap &#x3D; QPixmap()
        pixmap &#x3D; pixmap.fromImage(image)
        self._pixmap &#x3D; pixmap
        self.model().dataChanged.emit(self.index(), self.index())

    def setIconPath(self, iconPath):
        self._item.iconPath &#x3D; iconPath
        self._pixmap &#x3D; QPixmap(iconPath)

    def pixmap(self):
        &quot;&quot;&quot;
        :return:
        :rtype: QPixmap
        &quot;&quot;&quot;
        if not self._pixmap.isNull():
            return self._pixmap
        elif not os.path.exists(self._item.iconPath):
            return QPixmap()
        return self._pixmap

    def toolTip(self):
        return self._item.description()

    def isEditable(self, *args, **kwargs):
        return False

    def sizeHint(self):
        # todo: could be done better
        sizeHint &#x3D; self.model().view.iconSize()
        if self._pixmap:
            pxSize &#x3D; self._pixmap.rect().size()
        else:
            pxSize &#x3D; QSize(1, 1)

        size &#x3D; min(sizeHint.height(), sizeHint.width())
        pxSize &#x3D; QSize(128, 128) if pxSize &#x3D;&#x3D; QSize(0, 0) else pxSize
        if self.squareIcon:
            aspectRatio &#x3D; 1
        else:
            aspectRatio &#x3D; float(pxSize.width()) &#x2F; float(pxSize.height())
            if aspectRatio &lt;&#x3D; 1:
                sizeHint.setWidth(size * aspectRatio)
            else:
                sizeHint.setWidth(size * aspectRatio)

        sizeHint.setHeight(size + 1)

        if self.showText:
            sizeHint.setHeight(sizeHint.height() + self.textHeight + self.textPaddingV * 2)

        return sizeHint

    def font(self, index):
        return QFont(&quot;Roboto&quot;)

    def textAlignment(self, index):
        return Qt.AlignLeft | Qt.AlignBottom

    def iconAlignment(self, index):
        return Qt.AlignLeft | Qt.AlignVCenter

    def removeRow(self, item):
        if item.loaderThread.isRunning:
            item.loaderThread.wait()
        return super(TreeItem, self).removeRow(item)

    def removeRows(self, items):
        for item in items:
            if item.loaderThread.isRunning:
                item.loaderThread.wait()
        return super(TreeItem, self).removeRows(items)

    def isSelected(self, option):
        return option.state &amp; QStyle.State_Selected

    def isMouseOver(self, option):
        return option.state &amp; QStyle.State_MouseOver

    def setBorderWidth(self, width):
        self.borderWidth &#x3D; dpiScale(width)

    def paint(self, painter, option, index):
        painter.save()
        self._paintBackground(painter, option, index)
        if self.showText:
            self._paintText(painter, option, index)
        if self._pixmap is not None:
            self._paintIcon(painter, option, index)
        painter.restore()

    def _paintIcon(self, painter, option, index):
        &quot;&quot;&quot;
        :param painter:
        :type painter:  QPainter
        :param option:
        :type option:
        :param index:
        :type index:
        :return:
        :rtype:
        &quot;&quot;&quot;
        rect &#x3D; self.iconRect(option)
        pixmap &#x3D; self.pixmap()  # type: QPixmap
        if pixmap.isNull():
            return
        pixmap &#x3D; pixmap.scaled(
            rect.width() - self.borderWidth * 2,
            rect.height() - self.borderWidth * 2,
            self.aspectRatio,
            Qt.SmoothTransformation,
        )

        pixmapRect &#x3D; QRect(rect)
        pixmapRect.setWidth(pixmap.width())
        pixmapRect.setHeight(pixmap.height())
        aspectRatio &#x3D; float(pixmap.width()) &#x2F; float(pixmap.height())

        iconAlign &#x3D; self.iconAlignment(None)

        if iconAlign &amp; Qt.AlignHCenter &#x3D;&#x3D; Qt.AlignHCenter:
            x &#x3D; float(rect.width() - pixmap.width()) * 0.5
        elif iconAlign &amp; Qt.AlignLeft &#x3D;&#x3D; Qt.AlignLeft:
            x &#x3D; 0
        else:  # todo: set the rest of the flags
            x &#x3D; float(rect.width() - pixmap.width()) * 0.5
            print(&quot;Flags not set for TreeItem._paintIcon()! x-Value&quot;)

        if iconAlign &amp; Qt.AlignVCenter &#x3D;&#x3D; Qt.AlignVCenter:
            y &#x3D; float(rect.height() - pixmap.height()) * 0.5
        else:  # todo: set the rest of the flags
            y &#x3D; float(rect.height() - pixmap.height()) * 0.5
            print(&quot;Flags not set for TreeItem._paintIcon() y-Value!  &quot;)

        x +&#x3D; self.borderWidth
        pixmapRect.translate(x, y)

        # Hacky fixes to visuals &#x3D;[
        if self.squareIcon:
            clippedRect &#x3D; QRect(pixmapRect)
            clippedRect.setWidth(clippedRect.width() - 1)
            if clippedRect.height() &lt;&#x3D; clippedRect.width():  # Wide icons
                translate &#x3D; (clippedRect.width() - clippedRect.height()) &#x2F; 2
                clippedRect.setWidth(clippedRect.height() - 1)
                pixmapRect.translate(-translate, 0)
            else:  # Tall Icons
                translate &#x3D; (clippedRect.height() - clippedRect.width()) &#x2F; 2
                clippedRect.setHeight(clippedRect.width() + 2)
                clippedRect.setWidth(clippedRect.width())
                clippedRect.translate(0, translate)
            painter.setClipRect(clippedRect)
        else:
            if aspectRatio &gt; 1:
                pixmapRect.setWidth(pixmapRect.width())
            elif aspectRatio &gt;&#x3D; 1:
                pixmapRect.setWidth(pixmapRect.width() - 1)
        painter.drawPixmap(pixmapRect, pixmap)

    def _paintText(self, painter, option, index):
        isSelected &#x3D; self.isSelected(option)
        isMouseOver &#x3D; self.isMouseOver(option)
        text &#x3D; self._item.name
        color &#x3D; self.textColorSelected if isSelected else self.textColor
        rect &#x3D; QRect(option.rect)
        width &#x3D; rect.width() - self.textPaddingH * 2
        height &#x3D; rect.height()
        padding &#x3D; self.padding
        x, y &#x3D; padding, padding
        rect.translate(x + self.textPaddingH, y + self.textPaddingV)
        rect.setWidth(width - padding)
        rect.setHeight(height - padding - self.textPaddingV)
        font &#x3D; self.font(index)
        font.setPixelSize(self.textHeight)

        align &#x3D; self.textAlignment(index)
        metrics &#x3D; QFontMetricsF(font)
        textWidth &#x3D; metrics.width(text)
        # does the text fit? if not cut off the text
        if textWidth &gt; rect.width() - padding:
            text &#x3D; metrics.elidedText(text, Qt.ElideRight, rect.width())

        if isSelected:
            textBgColor &#x3D; self.borderColorSelected
        else:
            textBgColor &#x3D; self.textBGColor

        textBg &#x3D; QRect(option.rect)
        textBg.setTop(textBg.top() + textBg.height() - (self.textHeight + self.textPaddingV * 2))
        textBg.translate(max(1, self.borderWidth * 0.5), max(1, self.borderWidth * 0.5) - 2)
        textBg.setWidth(textBg.width() - self.borderWidth * 2 - 1)
        textBg.setHeight(self.textHeight + self.textPaddingV)
        painter.setBrush(textBgColor)
        painter.setPen(textBgColor)
        painter.drawRect(textBg)

        pen &#x3D; QPen(color)
        painter.setPen(pen)
        painter.setFont(font)
        painter.drawText(rect, align, text)

    def _paintBackground(self, painter, option, index):

        isSelected &#x3D; self.isSelected(option)
        isMouseOver &#x3D; self.isMouseOver(option)

        if isSelected:
            brush &#x3D; self.backgroundColorSelectedBrush

            if isMouseOver:
                borderColor &#x3D; self.borderColorHover
            else:
                borderColor &#x3D; self.borderColorSelected

        elif isMouseOver:
            brush &#x3D; self.backgroundColorHoverBrush
            borderColor &#x3D; self.borderColorHover
        else:
            brush &#x3D; self.backgroundBrush
            borderColor &#x3D; self.borderColor
        pen &#x3D; QPen(borderColor)
        pen.setJoinStyle(Qt.MiterJoin)
        pen.setWidth(self.borderWidth)
        painter.setPen(pen)

        rect &#x3D; QRect(option.rect)
        rect.setWidth(rect.width() - self.borderWidth)
        rect.setHeight(rect.height() - self.borderWidth)
        rect.translate(self.borderWidth * 0.5, self.borderWidth * 0.5)

        painter.setBrush(brush)
        painter.drawRect(rect)

        # Icon background
        iconPen &#x3D; QPen(self.backgroundColorIcon)
        iconPen.setWidth(0)
        iconRect &#x3D; QRect(rect)
        painter.setBrush(QBrush(self.backgroundColorIcon))
        iconRect.setHeight(iconRect.height() - (self.textHeight + self.textPaddingV * 2))
        iconRect.translate(max(1, self.borderWidth * 0.5), max(1, self.borderWidth * 0.5))
        iconRect.setWidth(iconRect.width() - self.borderWidth * 2)
        painter.setPen(iconPen)
        painter.drawRect(iconRect)

    def iconRect(self, option):
        padding &#x3D; self.padding
        rect &#x3D; option.rect
        width &#x3D; rect.width() - padding
        height &#x3D; rect.height() - padding
        # deal with the text #
        if self.showText:
            height -&#x3D; self.textHeight + self.textPaddingV * 2
        rect.setWidth(width)
        rect.setHeight(height)

        x &#x3D; padding + (float(width - rect.width()) * 0.5)
        y &#x3D; padding + (float(height - rect.height()) * 0.5)
        rect.translate(x, y)
        return rect


class ThreadedIcon(QRunnable):

    def __init__(self, iconPath, width&#x3D;None, height&#x3D;None, *args, **kwargs):
        super(ThreadedIcon, self).__init__(*args, **kwargs)
        self.signals &#x3D; ItemSignals()
        # Add the callback to our kwargs
        kwargs[&#39;progress_callback&#39;] &#x3D; self.signals.progress

        self._path &#x3D; iconPath
        self.width &#x3D; width
        self.height &#x3D; height
        self.placeHolderImage &#x3D; QImage(50, 50, QImage.Format_ARGB32)
        self.placeHolderImage.fill(qRgb(96, 96, 96))
        self._finished &#x3D; False

    def finished(self, state):
        self._finished &#x3D; state
        self.signals.finished.emit()

    def isFinished(self):
        return self._finished

    @Slot()
    def run(self):
        if not self._path or self._finished:
            return
        self.signals.updated.emit(self.placeHolderImage)
        try:
            image &#x3D; QImage(self._path)
        except Exception as er:
            self.signals.error.emit((er,))
            self.finished(True)
            return
        self.signals.updated.emit(image)
        self.finished(True)


class BaseItem(object):
    def __init__(self, name&#x3D;None, description&#x3D;None, iconPath&#x3D;None):
        self.name &#x3D; name or &quot;&quot;
        self.iconPath &#x3D; iconPath or &quot;&quot;
        self._description &#x3D; description or &quot;&quot;
        self.metadata &#x3D; &#123;&#125;
        self.user &#x3D; &quot;&quot;
        self.iconThread &#x3D; None  # type: ThreadedIcon

    def description(self):
        return self._description

    def iconLoaded(self):
        if self.iconThread is not None and self.iconThread.isFinished():
            return True
        return False

    def tags(self):
        return self.metadata.get(&quot;metadata&quot;, &#123;&#125;).get(&quot;tags&quot;, [])

    def hasTag(self, tag):
        for i in self.tags:
            if tag in i:
                return True
        return False

    def hasAnyTags(self, tags):
        for i in tags:
            if self.hasTag(i):
                return True
        return False

    def serialize(self):
        return &#123;&quot;metadata&quot;: &#123;&quot;time&quot;: &quot;&quot;,
                             &quot;version&quot;: &quot;&quot;,
                             &quot;user&quot;: &quot;&quot;,
                             &quot;name&quot;: self.name,
                             &quot;application&quot;: &#123;&quot;name&quot;: &quot;&quot;,
                                             &quot;version&quot;: &quot;&quot;&#125;,
                             &quot;description&quot;: &quot;&quot;,
                             &quot;tags&quot;: []&#125;,
                &#125;


class FileViewModel(QStandardItemModel):
    parentClosed &#x3D; Signal(bool)
    doubleClicked &#x3D; Signal(str)
    selectionChanged &#x3D; Signal(str)
    refreshRequested &#x3D; Signal()

    def __init__(self, view, directory&#x3D;None, extensions&#x3D;None, chunkCount&#x3D;20, uniformIcons&#x3D;False):
        &quot;&quot;&quot; 覆盖基本模型以处理缩略图视图小部件数据的加载，例如。特定文件&#x2F;图像
        此类是附加到缩略图视图的缩略图模型的最基本形式,给定并填充有“png”、“jpg”或“jpeg”图像的目录。
        工具提示也是从文件名生成的,可以进一步覆盖此类，以便在子目录（如 .zooScene 文件）中加载自定义图像。
        :param view: The viewer to assign this model data?
        :type view: thumbwidget.ThumbListView
        :param directory: The directory full path where the .zooScenes live
        :type directory: str
        :param chunkCount: The number of images to load at a time into the ThumbnailView widget
        :type chunkCount: int
        :param extensions: The image file extensions to override, otherwise will be [&quot;png&quot;, &quot;jpg&quot;, &quot;jpeg&quot;]
        :type extensions: list of basestring
        :param uniformIcons: False keeps the images non-square.  True the icons will be square, clipped on longest axis
        :type uniformIcons: bool
        &quot;&quot;&quot;
        super(FileViewModel, self).__init__(parent&#x3D;view)
        self.view &#x3D; view
        self.extensions &#x3D; extensions
        self.chunkCount &#x3D; chunkCount
        self.currentFilesList &#x3D; []  # the files loaded in the viewer, empty while initializing
        self.infoDictList &#x3D; None  # usually used for generating tooltips
        self.toolTipList &#x3D; None  # list of tooltips to match each images
        self.currentImage &#x3D; None  # the current image name selected (no image highlighted on creation)
        self.fileNameList &#x3D; None  # each file&#39;s name with an extension
        self.fileNameListNoExt &#x3D; None  # each file&#39;s name without an extension, for display
        self.directory &#x3D; None
        self.themePref &#x3D; None
        self.threadPool &#x3D; QThreadPool.globalInstance()
        self.lastFilter &#x3D; &quot;&quot;
        self.uniformIcons &#x3D; uniformIcons
        self.dynamicLoading &#x3D; True  # Dynamic icon loading

        # load the images
        if directory is not None:
            self.setDirectory(directory, True)

    def setDirectory(self, directory, refresh&#x3D;True):
        &quot;&quot;&quot;用于设置或更改目录&quot;&quot;&quot;
        self.directory &#x3D; directory
        if refresh:
            self.refreshList()

    def refreshList(self):
        &quot;&quot;&quot; 如果内容已修改，则刷新图标列表，不更改根目录 &quot;&quot;&quot;
        self.view.setUpdatesEnabled(False)
        self.clear()
        self.refreshModelData()
        self.loadData()
        self.view.setUpdatesEnabled(True)

    def _thumbnails(self, extensions&#x3D;None):
        &quot;&quot;&quot; 获取文件缩略图的完整路径名
        在这种情况下，缩略图是文件（图像）本身
            [&quot;C:&#x2F;aPath&#x2F;image01.jpg&quot;, &quot;C:&#x2F;aPath&#x2F;image02.jpg&quot;]
        如果您需要从其他位置获取缩略图，即 .zooScene 或 .hdr 文件的缩略图，请覆盖此设置
        :type extensions: 文件扩展名列表或设置为“None”以使用所有图像
        :return: List of paths to image files
        :rtype: list of basestring
        &quot;&quot;&quot;
        results &#x3D; []
        for i in self.fileNameList:
            fullPath &#x3D; os.path.join(self.directory, i)
            if extensions is None and isImage(fullPath):
                results.append(fullPath)
            else:
                # todo: do extensions
                pass

        return results

    def _infoDictionaries(self):
        &quot;&quot;&quot;重写基类,返回每个 .zooScene 文件的信息字典列表。这些词典包含作者、标签、描述等信息
        :return infoDictList: A list of info dictionaries for each .zooScene file
        :rtype infoDictList: list(dict)
        &quot;&quot;&quot;
        return infoDictionaries(self.fileNameList, self.directory)

    def _toolTips(self):
        &quot;&quot;&quot;重写基类将_toolTips生成为列表，由 self.infoDictList 构造而成&quot;&quot;&quot;
        self.toolTipList &#x3D; list()
        for i, thumb in enumerate(self.currentFilesList):
            self.toolTipList.append(self._createToolTip(self.infoDictList[i], self.fileNameList[i]))

    def _createToolTip(self, infoDictSingle, fileName):
        &quot;&quot;&quot;重写基类,从单个 zooScene 文件创建单个工具提示
        :param zooScenePath: The full path to the zooScene image
        :type zooScenePath: str
        :param infoDictSingle: The information dictionary with tag author and description information
        :type infoDictSingle: str
        :return toolTip: The tooltip description
        :rtype toolTip: str
        &quot;&quot;&quot;
        if not infoDictSingle:  # dict is none so return file path as tooltip
            return os.path.join(self.directory, fileName)
        # breaks on some unicode so convert to plain text
        filepath &#x3D; &quot;&#123;&#125; &quot;.format(os.path.join(self.directory, fileName))
        info &#x3D; &quot;&quot;
        website &#x3D; &quot;&quot;
        toolTip &#x3D; (&quot;&#123;&#125;&#123;&#125;&#123;&#125; &quot;.format(info, filepath, website))
        return toolTip

    def clear(self):
        &quot;&quot;&quot;清除模型中的图像和数据，通常在刷新时使用&quot;&quot;&quot;
        # remove any threads that haven&#39;t started yet
        self.threadPool.clear()

        while not self.threadPool.waitForDone():
            continue
        # clear any items, this is necessary to get python to GC alloc memory
        self.items &#x3D; []
        self.loadedCount &#x3D; 0
        self.currentFilesList &#x3D; []
        super(FileViewModel, self).clear()

    def fileList(self):
        &quot;&quot;&quot;更新self.fileNameList ,可以覆盖
        &quot;&quot;&quot;
        if not self.extensions:
            self.extensions &#x3D; [&quot;png&quot;, &quot;jpg&quot;, &quot;jpeg&quot;]
        if not isinstance(self.extensions, list):
            raise ValueError(&quot;Extensions must be list, \&quot;&#123;&#125;\&quot; type given \&quot;&#123;&#125;\&quot; &quot;.format(type(self.extensions),
                                                                                         self.extensions))
        self.fileNameList &#x3D; filesByExtension(self.directory, self.extensions)

    def filterList(self, text, tag&#x3D;None):
        &quot;&quot;&quot; 返回在搜索中显示或隐藏的行的整数列表
        :param text:
        :type text:
        :param tag:
        :type tag: 字符串或列表
        :return:
        :rtype:
        &quot;&quot;&quot;
        filterList &#x3D; list()
        if isinstance(tag, string_types):
            tag &#x3D; [tag]

        for i in range(len(self.infoDictList)):
            for t in tag:
                if t is None or t &#x3D;&#x3D; &quot;filename&quot;:
                    for j, fileName in enumerate(self.fileNameListNoExt):
                        if text.lower() in fileName.lower():
                            filterList.append(j)
                else:
                    if text.lower() in self.infoDictList[i][t.lower()].lower():
                        filterList.append(i)

        for i in range(len(self.fileNameListNoExt)):
            self.view.listView.setRowHidden(i, i not in filterList)  # Show row if not in filterList

        self.lastFilter &#x3D; text

        return filterList

    def refreshModelData(self):
        &quot;&quot;&quot;Needs to create&#x2F;recreate the thumbnail lists, tooltips and infoDict data
        &quot;&quot;&quot;
        self.fileList()  # updates self.fileNameList
        self.fileNameListNoExt &#x3D; [os.path.splitext(preset)[0] for preset in self.fileNameList]
        self.currentFilesList &#x3D; self._thumbnails()
        self.infoDictList &#x3D; self._infoDictionaries()
        self._toolTips()  # generates self.toolTipList
        self.refreshRequested.emit()

    def lazyLoadFilter(self):
        &quot;&quot;&quot;Breaks up the lists self.currentFilesList, self.fileNameList, self.toolTipList for lazy loading.
        Can be overridden, usually to choose if the display names should have extensions or not
        Default is no extensions on display names

        :return filesToLoad: The file name fullpath list (with extensions)
        :rtype filesToLoad: list of basestring
        :return namesToLoad: The name of the item, will be the label under the image, usually extension removed
        :rtype namesToLoad: list of basestring
        :return tooltipToLoad: The toolTip list to load
        :rtype tooltipToLoad: list of basestring
        &quot;&quot;&quot;
        if len(self.currentFilesList) &lt; self.loadedCount:
            filesToLoad &#x3D; self.currentFilesList
            namesToLoad &#x3D; self.fileNameListNoExt
            tooltipToLoad &#x3D; self.toolTipList
        else:
            filesToLoad &#x3D; self.currentFilesList[self.loadedCount: self.loadedCount + self.chunkCount]
            namesToLoad &#x3D; self.fileNameListNoExt[self.loadedCount: self.loadedCount + self.chunkCount]
            tooltipToLoad &#x3D; self.toolTipList[self.loadedCount: self.loadedCount + self.chunkCount]
        return filesToLoad, namesToLoad, tooltipToLoad

    def loadData(self):
        &quot;&quot;&quot; Overridden method that prepares the images for loading and viewing.
        Is filtered first via self.lazyLoadFilter()
        From base class documentation:
            Lazy loading happens either on first class initialization and any time the vertical bar hits the max value,
            we then grab the current the new file chunk by files[self.loadedCount: loadedCount + self.chunkCount] that
            way we are only loading a small amount at a time.
            Since this is an example of how to use the method , you can approach it in any way you wish but for each item you
            add you must initialize a item.BaseItem() or custom subclass and a item.treeItem or subclass which handles the
            qt side of the data per item
        &quot;&quot;&quot;

        if self.lastFilter !&#x3D; &quot;&quot;:  # Don&#39;t load any new data if theres a search going on
            return

        filesToLoad, namesToLoad, tooltipToLoad &#x3D; self.lazyLoadFilter()
        # Load the files
        for i, f in enumerate(filesToLoad):

            if f is None:
                f &#x3D; r&quot;C:\Users\mirror\Documents\zoo_preferences\assets\model_assets\scene_lightSetup_empty_fileDependencies\thumbnail.jpg&quot;

            workerThread &#x3D; ThreadedIcon(iconPath&#x3D;f)
            # create an item for the image type
            it &#x3D; BaseItem(name&#x3D;namesToLoad[i], iconPath&#x3D;f, description&#x3D;tooltipToLoad[i])
            qitem &#x3D; self.createItem(item&#x3D;it)
            workerThread.signals.updated.connect(partial(self.setItemIconFromImage, qitem))
            self.parentClosed.connect(workerThread.finished)

            it.iconThread &#x3D; workerThread

            if self.dynamicLoading is False:
                self.threadPool.start(workerThread)
            self.loadedCount +&#x3D; 1

        if len(filesToLoad) &gt; 0:
            pass

    def createItem(self, item):
        &quot;&quot;&quot;自定义包装器 创建 ：：类项的方法。TreeItem&#39;，将其添加到模型项和类 appendRow（）
        :param item:
        :type item: ::class:&#96;baseItem&#96;
        :return:
        :rtype: ::class:&#96;items.TreeItem&#96;
        &quot;&quot;&quot;
        tItem &#x3D; TreeItem(item&#x3D;item, themePref&#x3D;self.themePref, squareIcon&#x3D;self.uniformIcons)
        self.items.append(tItem)
        self.appendRow(tItem)
        return tItem

    def setUniformItemSizes(self, enabled):
        self.uniformIcons &#x3D; enabled
        for it in self.items:
            it.squareIcon &#x3D; enabled

    def setItemIconFromImage(self, item, image):
        &quot;&quot;&quot;由线程调用的自定义方法
        :param item:
        :type item: :class:&#96;TreeItem&#96;
        :param image: The Loaded QImage
        :type image: QImage
        &quot;&quot;&quot;
        item.applyFromImage(image)

    def doubleClickEvent(self, modelIndex, item):
        &quot;&quot;&quot;双击项时由列表视图调用
        :param modelIndex:
        :type modelIndex: QModelIndex
        :param item:
        :type item: TreeItem
        :return self.currentImage:  The current image with it&#39;s name and file extension
        :rtype self.currentImage:  str
        &quot;&quot;&quot;
        self.currentImage &#x3D; item._item.name
        self.doubleClicked.emit(self.currentImage)
        return self.currentImage

    def onSelectionChanged(self, modelIndex, item):
        &quot;&quot;&quot;在更改项目时由列表视图调用，例如左键单击或右键单击
        :param modelIndex:
        :type modelIndex: QModelIndex
        :param item:
        :type item: TreeItem
        &quot;&quot;&quot;
        try:  # can error while renaming files and the change no longer exists so ignore if so
            self.currentImage &#x3D; item._item.name
            self.selectionChanged.emit(self.currentImage)
            return self.currentImage
        except AttributeError:
            pass

    def closeEvent(self, event):
        &quot;&quot;&quot;关闭模型
        :param event:
        :type event:
        &quot;&quot;&quot;
        if self.qModel is not None:
            self.qModel.clear()
            self.qModel.parentClosed.emit(True)
        super(FileViewModel, self).closeEvent(event)


class ZooSceneViewerModel(FileViewModel):
    # Emit signals
    parentClosed &#x3D; Signal(bool)
    doubleClicked &#x3D; Signal(str)
    selectionChanged &#x3D; Signal(str)

    def __init__(self, view, directory&#x3D;&quot;&quot;, chunkCount&#x3D;20, uniformIcons&#x3D;False):
        &quot;&quot;&quot;从缩略图视图小组件的目录中加载 .zooscene 模型数据，拉取依赖目录中的缩略图，并从 file.zooInfo 文件生成工具提示。
        另请参阅类 FileViewModel（） 以获取更多功能和文档。其可以进一步覆盖此类以在子目录中加载自定义图像，例如Skydomes或控件
        使用 .zooScene 标签和缩略图信息。

        :param view: 查看器分配此模型数据
        :type view: qtWidget?
        :param directory: The directory full path where the .zooScenes live
        :type directory: str
        :param chunkCount: The number of images to load at a time into the ThumbnailView widget
        :type chunkCount: int
        &quot;&quot;&quot;
        super(ZooSceneViewerModel, self).__init__(view, directory&#x3D;directory, chunkCount&#x3D;chunkCount,
                                                  uniformIcons&#x3D;uniformIcons)

    def _thumbnails(self):
        &quot;&quot;&quot;重写基类，从每个文件的子目录“fileName_fileDependencies”返回缩略图路径的列表：
            [&quot;C:&#x2F;aPath&#x2F;scene01_fileDependencies&#x2F;thumbnail.jpg&quot;, &quot;C:&#x2F;aPath&#x2F;scene02_fileDependencies&#x2F;thumbnail.jpg&quot;]
        :return 当前文件列表 list(str):
        :return 缩略图列表 list(str):
        &quot;&quot;&quot;
        return [&quot;C:&#x2F;aPath&#x2F;scene01_fileDependencies&#x2F;thumbnail.jpg&quot;,
                &quot;C:&#x2F;aPath&#x2F;scene02_fileDependencies&#x2F;thumbnail.jpg&quot;]  # thumbnails(self.directory, self.fileNameListNoExt)

    def fileList(self):
        &quot;&quot;&quot;
        重写基类 生成文件列表：
        [“scene01.zooScene”， “scene02.zooScene”]
        &quot;&quot;&quot;
        self.fileNameList &#x3D; [&quot;scene01.zooScene&quot;, &quot;scene02.zooScene&quot;]  # filesByExtension(self.directory, [ZOOSCENE_EXT])

if __name__ &#x3D;&#x3D; &quot;__main__&quot;:
    app &#x3D; QApplication(sys.argv)
    thumbViewer &#x3D; ThumbnailViewWidget(parent&#x3D;None, columns&#x3D;3, fixedHeight&#x3D;382, uniformIcons&#x3D;True)
    thumbModel &#x3D; ZooSceneViewerModel(thumbViewer, directory&#x3D;r&quot;C:\Users\mirror\Documents\zoo_preferences\assets\model_assets&quot;,
                                                   chunkCount&#x3D;200,
                                                   uniformIcons&#x3D;True)
    thumbViewer.setModel(thumbModel)
    thumbViewer.show()
    sys.exit(app.exec_())


<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例结果：</p>
<p><img src="/images/QT-ListViewLayout/listViewLayout%E7%A4%BA%E4%BE%8B%E5%B1%95%E7%A4%BA.png" alt="示例展示　png" srcset="/images/home/Myhead.jpg" data-src="/images/QT-ListViewLayout/listViewLayout%E7%A4%BA%E4%BE%8B%E5%B1%95%E7%A4%BA.png" class="lozad post-image"> </p>

  </div>
  <div>
    
      <div 
        class="post-note note-warning copyright" 
        style="margin-top: 42px">
        <p>
          <span style="font-weight: bold;">作者：</span><a 
            target="_blank" 
            rel="nofollow noopener noreferrer" 
            href="/about">
            Mirror
          </a>
        </p>
        <p>
          <span style="font-weight: bold;">文章链接：</span><a 
            target="_blank" 
            rel="nofollow noopener noreferrer" 
            href="http://mirrorcg.github.io/posts/20221211a1.html">
            http://mirrorcg.github.io/posts/20221211a1.html
          </a>
        </p>
        <p><span style="font-weight: bold;">版权声明：</span>本博客所有文章除特别声明外，均采用<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0 协议</a>。转载请注明出处！</p>
      </div>
    
  </div>
</article>
<div class="nav">
  
    <div class="nav-item-prev">
      <a 
        href="/posts/20221212a1.html" 
        class="nav-link">
        <i class="iconfont icon-left nav-prev-icon"></i>
        <div>
          <div class="nav-label">上一篇</div>
          
            <div class="nav-title">Maya创建操纵器 </div>
          
        </div>
      </a>
    </div>
  
  
    <div class="nav-item-next">
      <a 
        href="/posts/20221115a1.html" 
        class="nav-link">
        <div>
          <div class="nav-label">下一篇</div>
          
            <div class="nav-title">QT-FlowLayout </div>
          
        </div>
        <i class="iconfont icon-right nav-next-icon"></i>
      </a>
    </div>
  
</div>

  <div 
    class="card card-content comment-card" 
    style="margin-top: 16px;">
    <div class="comment-card-title">评论</div>
    
  <div id="vcomments"></div>
  
  <script>
    loadScript("//unpkg.com/valine/dist/Valine.min.js");
    var oldLoadVa = window.onload;
    window.onload = function () {
      oldLoadVa && oldLoadVa();
      new Valine({
        el: '#vcomments',
        appId: 'to35UwTutrjzG0XtFw6gXeKa-gzGzoHsz',
        appKey: 'z22QceD9W40R0XI8WjvtKEuw',
        placeholder: '有话直说，不必拘礼',
        path: window.location.pathname,
        avatar: 'robohash',
        meta: ["nick","mail","link"],
        pageSize: '10',
        lang: '',
        visitor: 'true',
        highlight: true,
        recordIP: true,
        
        
        
        enableQQ: 'true',
        requiredFields: [],
      });
    };
  </script>

  </div>

<div 
  class="card card-content toc-card" 
  id="mobiletoc">
  <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>目录
</div>

</div></main>
            <aside class="left-column">
              
              <div class="card card-author">
                
  <img 
    src="/images/home/Myhead.jpg" 
    class="author-img"
    width="88"
    height="88"
    alt="author avatar">

<p class="author-name">Mirror</p>
<p class="author-description">一个默默写博客的人,记录工作踩坑和学习过程</p>
<div class="author-message">
  <a 
    class="author-posts-count" 
    href="/archives">
    <span>44</span>
    <span>文章</span>
  </a>
  <a 
    class="author-categories-count" 
    href="/categories">
    <span>17</span>
    <span>分类</span>
  </a>
  <a 
    class="author-tags-count" 
    href="/tags">
    <span>36</span>
    <span>标签</span>
  </a>
</div>

  <div class="author-card-society">
    
      <div class="author-card-society-icon">
        <a target="_blank" rel="noopener" href="https://github.com/MirrorCG">
          <i class="iconfont icon-github society-icon"></i>
        </a>
      </div>
    
      <div class="author-card-society-icon">
        <a href="/images/home/QQ.jpg">
          <i class="iconfont icon-mail society-icon"></i>
        </a>
      </div>
    
      <div class="author-card-society-icon">
        <a href="/images/home/weixin.jpg">
          <i class="iconfont icon-wechat society-icon"></i>
        </a>
      </div>
    
  </div>

              </div>
               <div class="sticky-tablet">
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css">
    <div id="aplayer"></div>
    <div id="aplayer" style="position:absolute;left;0;bottom:0;"></div>
    <script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/color-thief-don@2.0.2/src/color-thief.js"></script>
    <script>
      const ap = new APlayer({
        container: document.getElementById('aplayer'),
        autoplay: true, //自动播放
        listFolded: true, //播放列表默认折叠
        listMaxHeight: 90, //播放列表最大高度
        order: 'random', //音频循环顺序, 可选值: 'list', 'random'
        loop: 'all', //音频循环播放, 可选值: 'all', 'one', 'none'
        theme: '#e9e9e9', //切换音频时的主题色，优先级低于audio.theme
        preload: 'none', //音频预加载，可选值: 'none', 'metadata', 'auto'
        mutex: true, //互斥，阻止多个播放器同时播放，当前播放器播放时暂停其他播放器
        lrcType: 3, //歌词格式，可选值：3（LRC文件歌词格式），1（JS字符串歌词格式）
        volume: 0.7, //默认音量，请注意播放器会记忆用户设置，用户手动设置音量后默认音量即失效
        fixed: false, //吸底模式（fixed:true），迷你模式（mini:true），普通模式（注释此行或者设置fixed:false）
        audio: [{// https://music.liuzhijin.cn/ 这是歌曲查询网站
            name: '浪漫过敏',
            artist: '福合埕在逃牛肉丸',
            lrc: '',
            cover: '/images/themes/G.png',
            url: 'http://music.163.com/song/media/outer/url?id=1921676493.mp3'
          },
          {
            name: '日暮里',
            artist: 'JINBAO',
            lrc: '',
            cover: '/images/themes/M.png',
            url: 'http://music.163.com/song/media/outer/url?id=1351183637.mp3'
          },
          {
            name: '今晚有雨',
            artist: '福合埕在逃牛肉丸',
            lrc: '',
            cover: '/images/themes/J.png',
            url: 'http://music.163.com/song/media/outer/url?id=1921683713.mp3'
          },
          {
            name: '漫步于星云之中',
            artist: 'UM,Relimax,snxsn',
            lrc: '',
            cover: '/images/themes/L.png',
            url: 'http://music.163.com/song/media/outer/url?id=1914485227.mp3'
          }
        ]
      });
    
      //实现切换音频时，根据音频的封面图片自适应主题色
      const colorThief = new ColorThief();
      const setTheme = (index) => {
        if (!ap.list.audios[index].theme) {
          colorThief.getColorAsync(ap.list.audios[index].cover, function(color) {
            ap.theme(`rgb(${color[0]}, ${color[1]}, ${color[2]})`, index);
          });
        }
      };
      setTheme(ap.list.index);
      ap.on('listswitch', (data) => {
        setTheme(data.index);
      });
    </script>
    




   
  
    <article class="display-when-two-columns spacer">
      <div class="card card-content toc-card">
        <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>目录
</div>

      </div>
    </article>
  
  
  <article class="card card-content categories-widget">
    <div class="categories-card">
  <div class="categories-header">
    <i 
      class="iconfont icon-fenlei" 
      style="padding-right: 2px;">
    </i>分类
  </div>
  <div class="categories-list">
    
      <a href="/categories/Doc/">
        <div class="categories-list-item">
          Doc
          <span class="categories-list-item-badge">10</span>
        </div>
      </a>
    
      <a href="/categories/Deadline/">
        <div class="categories-list-item">
          Deadline
          <span class="categories-list-item-badge">3</span>
        </div>
      </a>
    
      <a href="/categories/Doc/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
        <div class="categories-list-item">
          Doc/学习笔记
          <span class="categories-list-item-badge">7</span>
        </div>
      </a>
    
      <a href="/categories/Maya/">
        <div class="categories-list-item">
          Maya
          <span class="categories-list-item-badge">16</span>
        </div>
      </a>
    
      <a href="/categories/Deadline/%E6%8F%92%E4%BB%B6/">
        <div class="categories-list-item">
          Deadline/插件
          <span class="categories-list-item-badge">3</span>
        </div>
      </a>
    
      <a href="/categories/Nuke/">
        <div class="categories-list-item">
          Nuke
          <span class="categories-list-item-badge">4</span>
        </div>
      </a>
    
      <a href="/categories/Python/">
        <div class="categories-list-item">
          Python
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/Maya/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
        <div class="categories-list-item">
          Maya/学习笔记
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/Qt/">
        <div class="categories-list-item">
          Qt
          <span class="categories-list-item-badge">6</span>
        </div>
      </a>
    
      <a href="/categories/Maya/%E5%B0%8F%E5%B7%A5%E5%85%B7/">
        <div class="categories-list-item">
          Maya/小工具
          <span class="categories-list-item-badge">5</span>
        </div>
      </a>
    
      <a href="/categories/ShotGrid/">
        <div class="categories-list-item">
          ShotGrid
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/Maya/%E6%9D%82%E9%A1%B9/">
        <div class="categories-list-item">
          Maya/杂项
          <span class="categories-list-item-badge">8</span>
        </div>
      </a>
    
      <a href="/categories/Rez/">
        <div class="categories-list-item">
          Rez
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/Maya/arnold/">
        <div class="categories-list-item">
          Maya/arnold
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/Nuke/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
        <div class="categories-list-item">
          Nuke/学习笔记
          <span class="categories-list-item-badge">4</span>
        </div>
      </a>
    
      <a href="/categories/Qt/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
        <div class="categories-list-item">
          Qt/学习笔记
          <span class="categories-list-item-badge">6</span>
        </div>
      </a>
    
      <a href="/categories/ShotGrid/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
        <div class="categories-list-item">
          ShotGrid/学习笔记
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
  </div>
</div>
  </article>
  
  <article class="card card-content tags-widget">
    <div class="tags-card">
  <div class="tags-header">
    <i 
      class="iconfont icon-biaoqian" 
      style="padding-right: 2px;">
    </i>热门标签
  </div>
  <div class="tags-list">
    
      <a 
        href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" 
        title="学习笔记">
        <div class="tags-list-item">学习笔记</div>
      </a>
    
      <a 
        href="/tags/Pipeline/" 
        title="Pipeline">
        <div class="tags-list-item">Pipeline</div>
      </a>
    
      <a 
        href="/tags/%E6%8E%92%E9%94%99%E8%AE%B0%E5%BD%95/" 
        title="排错记录">
        <div class="tags-list-item">排错记录</div>
      </a>
    
      <a 
        href="/tags/%E7%81%AF%E5%85%89/" 
        title="灯光">
        <div class="tags-list-item">灯光</div>
      </a>
    
      <a 
        href="/tags/%E9%94%A6%E5%9B%8A%E5%B0%8F%E5%A6%99%E6%8B%9B/" 
        title="锦囊小妙招">
        <div class="tags-list-item">锦囊小妙招</div>
      </a>
    
      <a 
        href="/tags/QT%E4%BA%8B%E4%BB%B6/" 
        title="QT事件">
        <div class="tags-list-item">QT事件</div>
      </a>
    
      <a 
        href="/tags/API/" 
        title="API">
        <div class="tags-list-item">API</div>
      </a>
    
      <a 
        href="/tags/QT%E5%B8%83%E5%B1%80/" 
        title="QT布局">
        <div class="tags-list-item">QT布局</div>
      </a>
    
      <a 
        href="/tags/Blog/" 
        title="Blog">
        <div class="tags-list-item">Blog</div>
      </a>
    
      <a 
        href="/tags/%E6%8F%92%E4%BB%B6/" 
        title="插件">
        <div class="tags-list-item">插件</div>
      </a>
    
      <a 
        href="/tags/%E7%81%AF%E5%85%89%E5%90%88%E6%88%90/" 
        title="灯光合成">
        <div class="tags-list-item">灯光合成</div>
      </a>
    
      <a 
        href="/tags/Aov/" 
        title="Aov">
        <div class="tags-list-item">Aov</div>
      </a>
    
      <a 
        href="/tags/%E4%BF%A1%E5%8F%B7-%E6%A7%BD/" 
        title="信号&槽">
        <div class="tags-list-item">信号&amp;槽</div>
      </a>
    
      <a 
        href="/tags/%E5%90%91%E9%87%8F%E8%AE%A1%E7%AE%97/" 
        title="向量计算">
        <div class="tags-list-item">向量计算</div>
      </a>
    
      <a 
        href="/tags/OpenMaya/" 
        title="OpenMaya">
        <div class="tags-list-item">OpenMaya</div>
      </a>
    
      <a 
        href="/tags/Hexo/" 
        title="Hexo">
        <div class="tags-list-item">Hexo</div>
      </a>
    
  </div>
</div>
  </article>
  
  
</div>
            </aside>
            <aside class="right-column">
              <div class="sticky-widescreen">
  
  
    <article class="card card-content toc-card">
      <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>目录
</div>

    </article>
  
  
  <article class="card card-content">
    <div class="recent-posts-card">
  <div class="recent-posts-header">
    <i 
      class="iconfont icon-wenzhang_huaban" 
      style="padding-right: 2px;">
    </i>最近文章
  </div>
  <div class="recent-posts-list">
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2022-12-12</div>
        <a href="/posts/20221212a1.html"><div class="recent-posts-item-content">Maya创建操纵器</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2022-12-11</div>
        <a href="/posts/20221211a1.html"><div class="recent-posts-item-content">QT-ListViewLayout</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2022-11-15</div>
        <a href="/posts/20221115a1.html"><div class="recent-posts-item-content">QT-FlowLayout</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2022-10-31</div>
        <a href="/posts/20221031a1.html"><div class="recent-posts-item-content">Maya_C++开发环境搭建</div></a>
      </div>
    
  </div>
</div>
  </article>
  
  
</div>
            </aside>
          </div>
        </div>
      </div>
    </div>
     
    <footer class="footer">
  <div class="footer-container">
    <div>
      <div class="footer-dsc">
        <span>
          Copyright ©
          
            2022 -
          
          2022
        </span>
        &nbsp;
        <a 
          href="/" 
          class="footer-link">
          Mirror`s Blog
        </a>
      </div>
    </div>

    
      <div class="footer-dsc">
        
          Powered by
          <a 
            href="https://hexo.io/" 
            class="footer-link" 
            target="_blank" 
            rel="nofollow noopener noreferrer">
            &nbsp;Hexo
          </a>
        
        
          <span>&nbsp;|&nbsp;</span>
        
        
          Theme -
          <a 
            href="https://github.com/theme-kaze" 
            class="footer-link" 
            target="_blank"
            rel="nofollow noopener noreferrer">
            &nbsp;Kaze
          </a>
        
      </div>
    
    
    
      <div class="BbeiAn-info">
        <a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">蜀ICP备2022006030号 </a>
      </div>
      
    
    
      <div class="footer-dsc">
        
          小站被客官们总光顾<span id="busuanzi_value_site_pv"></span>次
        
        
          <span>&nbsp;|&nbsp;</span>
        
        
          小站总接待客官<span id="busuanzi_value_site_uv"></span>人
        
      </div>
      
    
</footer> 
    
  <a 
    role="button" 
    id="scrollbutton" 
    class="basebutton" 
    aria-label="回到顶部">
    <i class="iconfont icon-arrowleft button-icon"></i>
  </a>

<a 
  role="button" 
  id="menubutton"
  aria-label="menu button"
  class="basebutton">
  <i class="iconfont icon-menu button-icon"></i>
</a>
<a 
  role="button" 
  id="popbutton" 
  class="basebutton" 
  aria-label="控制中心">
  <i class="iconfont icon-expand button-icon"></i>
</a>
<a 
  role="button" 
  id="darkbutton" 
  class="basebutton darkwidget" 
  aria-label="夜色模式">
  <i class="iconfont icon-weather button-icon"></i>
</a>
<a 
  role="button" 
  id="searchbutton" 
  class="basebutton searchwidget" 
  aria-label="搜索">
  <i class="iconfont icon-search button-icon"></i>
</a> 
     
     
     
      <script>
  var addImgLayout = function () {
    var img = document.querySelectorAll('.post-content img')
    var i
    for (i = 0; i < img.length; i++) {
      var wrapper = document.createElement('a')
      wrapper.setAttribute('href', img[i].getAttribute('data-src'))
      wrapper.setAttribute('aria-label', 'illustration')
      wrapper.style.cssText =
        'width: 100%; display: flex; justify-content: center;'
      if (img[i].alt) wrapper.dataset.caption = img[i].alt
      wrapper.dataset.nolink = true
      img[i].before(wrapper)
      wrapper.append(img[i])
      var divWrap = document.createElement('div')
      divWrap.classList.add('gallery')
      wrapper.before(divWrap)
      divWrap.append(wrapper)
    }
    baguetteBox.run('.gallery')
  }
</script>
<script>
  loadScript(
    "/js/lib/lightbox/baguetteBox.min.js",
    addImgLayout
  )
</script>
 
     
     
    <script src="/js/main.js"></script> 
    
      <script> 
        loadScript('/js/lib/busuanzi.min.js') 
      </script>
     
    
      <script>
        var addLazyload = function () {
          var observer = lozad('.lozad', {
            load: function (el) {
              el.srcset = el.getAttribute('data-src')
            },
            loaded: function (el) {
              el.classList.add('loaded')
            },
          })
          observer.observe()
        }
      </script>
      <script>
        loadScript('/js/lib/lozad.min.js', addLazyload)
      </script>
     
    
    
      <script>
        setTimeout(() => {localSearch("search.json")}, 0)
      </script>
    



  


  </body>
</html>
